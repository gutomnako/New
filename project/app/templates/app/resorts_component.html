<!-- resorts_component.html -->

{% load static %}

<main class="main-content">
    <div class="card-grid">

        <!-- Displaying Resorts -->
        {% for resort in resorts %}
        <div class="card">
            {% if resort.resort_image %}
                <img src="{{ resort.resort_image.url }}" alt="">
            {% endif %}

            <!-- Rating Form -->
            <form method="POST" action="{% url 'rate_resort' resort.id %}" class="rating-form">
                {% csrf_token %}
                <label for="rating-{{ resort.id }}">Rate this Resort:</label>
            
                <div class="stars">
                    <span class="star" data-value="1">&#9734;</span>
                    <span class="star" data-value="2">&#9734;</span>
                    <span class="star" data-value="3">&#9734;</span>
                    <span class="star" data-value="4">&#9734;</span>
                    <span class="star" data-value="5">&#9734;</span>
                </div>
            
                <!-- Hidden input to hold the rating value -->
                <input type="hidden" id="rating-{{ resort.id }}" name="rating" value="0">
            
                <button type="submit">Submit Rating</button>
            </form>
            

            <h5>{{ resort.name }}</h5>
            <p>{{ resort.description }}</p>
            <p>Entrance Kids: {{ resort.entrance_kids }} | Entrance Adults: {{ resort.entrance_adults }}</p>
            <p>Cottage: {{ resort.price }}</p>
            <button type="button">
                <a href="{% url 'resort' resort.id %}">Details</a>
            </button>
        </div>
        {% endfor %}

    </div>
</main>

<script>
// Get all the star elements
const stars = document.querySelectorAll('.star');

// Iterate over each star and add the click event
stars.forEach(star => {
    star.addEventListener('click', function () {
        const rating = this.getAttribute('data-value'); // Get the rating value
        const ratingInput = this.closest('form').querySelector('input[name="rating"]'); // Find the hidden input

        // Set the value of the hidden input to the selected rating
        ratingInput.value = rating;

        // Update the star UI (add 'active' class to the selected stars)
        const starsContainer = this.closest('.stars');
        starsContainer.querySelectorAll('.star').forEach(s => s.classList.remove('active'));
        for (let i = 0; i < rating; i++) {
            starsContainer.children[i].classList.add('active');
        }
    });
});

  </script>
